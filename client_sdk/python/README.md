# Bunkerhill Health Inference API Python Client

Contains a Python client for the Bunkerhill Inference API, which allows third-party applications to access inferences generated from Bunkerhill models.

## Table of contents

1. [Overview](#overview)
2. [Installation](#installation)
3. [Credentials](#credentials)
4. [Usage Instructions](#usage-instructions)
5. [API Reference](#api-reference)

## Overview

The inference API allows third parties to integrate Bunkerhill data into their applications. Such applications can authenticate into Bunkerhill's system and access data generated by models, with the ability to filter by fields such as model ID and patient MRN.

## Installation

### From package management

Coming soon

### From source

To install from source, clone the repo locally. Then run the following

```
python -m pip install client_sdk/python
```

## Credentials

Authentication to the server depends on the use of a username / private key combination. Please obtain these credentials from Bunkerhill Health by reaching out to # TODO - insert email. The private key should be stored locally and securely, for example in a file named `private_key.pem`.

The credentials are exchanged with the server for a JWT access token, which is managed by the Python client and automatically passed with all API requests.

## Usage Instructions

Once installed, import the library into your Python file and make calls to the API using the `InferenceAPIClient`. 

For example, to query for all inferences for patient with mrn `$PATIENT_MRN` and model ID `$MODEL_ID`, run:

```
from bunkerhill_inference_api import InferenceAPIClient

async with InferenceAPIClient(
  username='$USERNAME',
  private_key_filename='/Users/gabealvarez/bunkerhill/bunkerhill/private_key.pem',
) as client:
  inference_list = await client.get_inferences(
    model_id='$MODEL_ID',
    patient_mrn='$PATIENT_MRN',
  )
```

## API Reference

### InferenceAPIClient

#### Constructor
```
InferenceAPIClient(
  username: str,
  private_key_filename: Optional[str] = None,
  private_key_string: Optional[str] = None,
  base_url: str = 'https://api.bunkerhillhealth.com/',
 )
```

##### Parameters:

username (str): The username to authenticate the client.\
private_key_filename (Optional[str]): Filename of the RSA private key.\
private_key_string (Optional[str]): The RSA private key as a string.\
base_url (str, optional): The base URL of the Django API. Defaults to 'https://api.bunkerhillhealth.com/'.

_Note:_ At least one of private_key_filename or private_key_string must be provided.

#### get_inferences
```
get_inferences(
  model_id: str,
  patient_mrn: str,
) -> List[Inference]
```

Asynchronously fetches a list of Inference objects for a given patient and a given model from the Inference API.

##### Parameters:
model_id (str): The model ID to fetch inferences for. \
patient_mrn (str): The medical record number (MRN) of the patient. \

##### Returns:
List[Inference]: A list of JSON Dicts, one for each Inference.

_Notes:_
- You must have authorization to the specified `model_id` - if not, a 403 error will be raised.
- Only inferences corresponding to institutions that you are authorized to will be returned.
